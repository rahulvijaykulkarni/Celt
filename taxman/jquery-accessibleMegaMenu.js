(function(n,t,i){"use strict";function f(t,i){this.element=t;this.settings=n.extend({},e,i);this._defaults=e;this._name=u;this.mouseTimeoutID=null;this.focusTimeoutID=null;this.mouseFocused=!1;this.justFocused=!1;this.init()}function o(t){return n.expr.filters.visible(t)&&!n(t).parents().addBack().filter(function(){return n.css(this,"visibility")==="hidden"}).length}function s(t,i){var r,u,f,e=t.nodeName.toLowerCase();return"area"===e?(r=t.parentNode,u=r.name,!t.href||!u||r.nodeName.toLowerCase()!=="map")?!1:(f=n("img[usemap=#"+u+"]")[0],!!f&&o(f)):(/input|select|textarea|button|object/.test(e)?!t.disabled:"a"===e?t.href||i:i)&&o(t)}var u="accessibleMegaMenu",e={uuidPrefix:"accessible-megamenu",menuClass:"accessible-megamenu",topNavItemClass:"accessible-megamenu-top-nav-item",panelClass:"accessible-megamenu-panel",panelGroupClass:"accessible-megamenu-panel-group",hoverClass:"hover",focusClass:"focus",openClass:"open"},r={BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38,keyMap:{48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",59:";",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",190:"."}};f.prototype=function(){var nt=0,tt=1e3,o="",y=typeof t.hasOwnProperty=="function"&&!!t.hasOwnProperty("ontouchstart"),p,c,e,s,h,l,w,b,a,k,d,g,v;return p=function(t){return n(t).closest(":data(plugin_"+u+")").data("plugin_"+u)},c=function(t){t=n(t);var i=this.settings;t.attr("id")||t.attr("id",i.uuidPrefix+"-"+(new Date).getTime()+"-"+ ++nt)},e=function(t,u){var o=n(t.target),s=this,f=this.settings,c=this.menu,e=o.closest("."+f.topNavItemClass),a=o.hasClass(f.panelClass)?o:o.closest("."+f.panelClass),l;if(v.call(this,u),n("html").off("mouseup.outside-accessible-megamenu, touchend.outside-accessible-megamenu, mspointerup.outside-accessible-megamenu, pointerup.outside-accessible-megamenu",h),c.find("[aria-expanded]."+this.settings.panelClass).off("DOMAttrModified.accessible-megamenu"),u)if(e=c.find("."+f.topNavItemClass+" ."+f.openClass+":first").closest("."+f.topNavItemClass),e.is(t.relatedTarget)||e.has(t.relatedTarget).length>0)e.length===0&&c.find("[aria-expanded=true]").attr("aria-expanded","false").removeClass(f.openClass).filter("."+f.panelClass).attr("aria-hidden","true");else{if((t.type==="mouseout"||t.type==="focusout")&&e.has(i.activeElement).length>0)return;e.find("[aria-expanded]").attr("aria-expanded","false").removeClass(f.openClass).filter("."+f.panelClass).attr("aria-hidden","true");(t.type==="keydown"&&t.keyCode===r.ESCAPE||t.type==="DOMAttrModified")&&(l=e.find(":tabbable:first"),setTimeout(function(){c.find("[aria-expanded]."+s.settings.panelClass).off("DOMAttrModified.accessible-megamenu");l.focus();s.justFocused=!1},99))}else clearTimeout(s.focusTimeoutID),e.siblings().find("[aria-expanded]").attr("aria-expanded","false").removeClass(f.openClass).filter("."+f.panelClass).attr("aria-hidden","true"),e.find("[aria-expanded]").attr("aria-expanded","true").addClass(f.openClass).filter("."+f.panelClass).attr("aria-hidden","false"),t.type==="mouseover"&&o.is(":tabbable")&&e.length===1&&a.length===0&&c.has(i.activeElement).length>0&&(o.focus(),s.justFocused=!1),v.call(s)},s=function(t){var i=n(t.target),r=i.closest("."+this.settings.topNavItemClass),u=i.closest("."+this.settings.panelClass);r.length===1&&u.length===0&&r.find("."+this.settings.panelClass).length===1&&(i.hasClass(this.settings.openClass)?this.justFocused?(t.preventDefault(),t.stopPropagation(),this.justFocused=!1):y&&(t.preventDefault(),t.stopPropagation(),e.call(this,t,i.hasClass(this.settings.openClass))):(t.preventDefault(),t.stopPropagation(),e.call(this,t)))},h=function(t){this.menu.has(n(t.target)).length===0&&(t.preventDefault(),t.stopPropagation(),e.call(this,t,!0))},l=function(t){t.originalEvent.attrName==="aria-expanded"&&t.originalEvent.newValue==="false"&&n(t.target).hasClass(this.settings.openClass)&&(t.preventDefault(),t.stopPropagation(),e.call(this,t,!0))},w=function(t){clearTimeout(this.focusTimeoutID);n(t.target).addClass(this.settings.focusClass).on("click.accessible-megamenu",n.proxy(s,this));this.justFocused=!this.mouseFocused;this.mouseFocused=!1;this.panels.filter("."+this.settings.openClass).length&&e.call(this,t)},b=function(i){this.justFocused=!1;var r=this,u=n(i.target),f=u.closest("."+this.settings.topNavItemClass);u.removeClass(this.settings.focusClass).off("click.accessible-megamenu",n.proxy(s,this));r.focusTimeoutID=t.cvox?setTimeout(function(){t.cvox.Api.getCurrentNode(function(n){f.has(n).length?clearTimeout(r.focusTimeoutID):r.focusTimeoutID=setTimeout(function(n,t,i){e.call(n,t,i)},275,r,i,!0)})},25):setTimeout(function(){e.call(r,i,!0)},300)},a=function(i){var v=this.constructor===f?this:p(this),a=v.settings,l=n(n(this).is("."+a.hoverClass+":tabbable")?this:i.target),ot=v.menu,w=v.topnavitems,y=l.closest("."+a.topNavItemClass),u=ot.find(":tabbable"),ft=l.hasClass(a.panelClass)?l:l.closest("."+a.panelClass),d=ft.find("."+a.panelGroupClass),nt=l.closest("."+a.panelGroupClass),g,st=i.keyCode||i.which,rt,c,b,it,h=!1,et=r.keyMap[i.keyCode]||"",ut,k=y.length===1&&ft.length===0;if(!l.is("input:focus, select:focus, textarea:focus, button:focus")){l.is("."+a.hoverClass+":tabbable")&&n("html").off("keydown.accessible-megamenu");switch(st){case r.ESCAPE:e.call(v,i,!0);break;case r.DOWN:i.preventDefault();k?(e.call(v,i),h=y.find("."+a.panelClass+" :tabbable:first").focus().length===1):h=u.filter(":gt("+u.index(l)+"):first").focus().length===1;!h&&t.opera&&opera.toString()==="[object Opera]"&&(i.ctrlKey||i.metaKey)&&(u=n(":tabbable"),c=u.index(l),h=n(":tabbable:gt("+n(":tabbable").index(l)+"):first").focus().length===1);break;case r.UP:i.preventDefault();k&&l.hasClass(a.openClass)?(e.call(v,i,!0),g=w.filter(":lt("+w.index(y)+"):last"),g.children("."+a.panelClass).length&&(h=g.children().attr("aria-expanded","true").addClass(a.openClass).filter("."+a.panelClass).attr("aria-hidden","false").find(":tabbable:last").focus()===1)):k||(h=u.filter(":lt("+u.index(l)+"):last").focus().length===1);!h&&t.opera&&opera.toString()==="[object Opera]"&&(i.ctrlKey||i.metaKey)&&(u=n(":tabbable"),c=u.index(l),h=n(":tabbable:lt("+n(":tabbable").index(l)+"):first").focus().length===1);break;case r.RIGHT:i.preventDefault();k?h=w.filter(":gt("+w.index(y)+"):first").find(":tabbable:first").focus().length===1:(d.length&&nt.length&&(h=d.filter(":gt("+d.index(nt)+"):first").find(":tabbable:first").focus().length===1),h||(h=y.find(":tabbable:first").focus().length===1));break;case r.LEFT:i.preventDefault();k?h=w.filter(":lt("+w.index(y)+"):last").find(":tabbable:first").focus().length===1:(d.length&&nt.length&&(h=d.filter(":lt("+d.index(nt)+"):last").find(":tabbable:first").focus().length===1),h||(h=y.find(":tabbable:first").focus().length===1));break;case r.TAB:c=u.index(l);i.shiftKey&&k&&l.hasClass(a.openClass)?(e.call(v,i,!0),g=w.filter(":lt("+w.index(y)+"):last"),g.children("."+a.panelClass).length&&(h=g.children().attr("aria-expanded","true").addClass(a.openClass).filter("."+a.panelClass).attr("aria-hidden","false").find(":tabbable:last").focus())):i.shiftKey&&c>0?h=u.filter(":lt("+c+"):last").focus().length===1:!i.shiftKey&&c<u.length-1?h=u.filter(":gt("+c+"):first").focus().length===1:t.opera&&opera.toString()==="[object Opera]"&&(u=n(":tabbable"),c=u.index(l),h=i.shiftKey?n(":tabbable:lt("+n(":tabbable").index(l)+"):last").focus().length===1:n(":tabbable:gt("+n(":tabbable").index(l)+"):first").focus().length===1);h&&i.preventDefault();break;case r.SPACE:if(k)i.preventDefault(),s.call(v,i);else return!0;break;case r.ENTER:return!0;default:if(clearTimeout(this.keydownTimeoutID),o+=et!==o?et:"",o.length===0)return;for(this.keydownTimeoutID=setTimeout(function(){o=""},tt),u=k&&!l.hasClass(a.openClass)?u.filter(":not(."+a.panelClass+" :tabbable)"):y.find(":tabbable"),i.shiftKey&&(u=n(u.get().reverse())),c=0;c<u.length;c++)if(b=u.eq(c),b.is(l)){rt=o.length===1?c+1:c;break}for(ut=new RegExp("^"+o.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&"),"i"),c=rt;c<u.length;c++)if(b=u.eq(c),it=n.trim(b.text()),ut.test(it)){h=!0;b.focus();break}if(!h)for(c=0;c<rt;c++)if(b=u.eq(c),it=n.trim(b.text()),ut.test(it)){b.focus();break}}v.justFocused=!1}},k=function(t){n(t.target).is(":tabbable, :focusable, ."+this.settings.panelClass)&&(this.mouseFocused=!0);this.mouseTimeoutID=setTimeout(function(){clearTimeout(this.focusTimeoutID)},1)},d=function(t){if(clearTimeout(this.mouseTimeoutID),n(t.target).addClass(this.settings.hoverClass),e.call(this,t),n(t.target).is(":tabbable"))n("html").on("keydown.accessible-megamenu",n.proxy(a,t.target))},g=function(t){var i=this;n(t.target).removeClass(i.settings.hoverClass);i.mouseTimeoutID=setTimeout(function(){e.call(i,t,!0)},250);n(t.target).is(":tabbable")&&n("html").off("keydown.accessible-megamenu")},v=function(t){var i=this.menu;if(t)n("html").off("mouseup.outside-accessible-megamenu, touchend.outside-accessible-megamenu, mspointerup.outside-accessible-megamenu,  pointerup.outside-accessible-megamenu",h),i.find("[aria-expanded]."+this.settings.panelClass).off("DOMAttrModified.accessible-megamenu",l);else{n("html").on("mouseup.outside-accessible-megamenu, touchend.outside-accessible-megamenu, mspointerup.outside-accessible-megamenu,  pointerup.outside-accessible-megamenu",n.proxy(h,this));i.find("[aria-expanded=true]."+this.settings.panelClass).on("DOMAttrModified.accessible-megamenu",n.proxy(l,this))}},{constructor:f,init:function(){var r=this,t=this.settings,u=this.nav=n(this.element),i=this.menu=u.children().first(),f=this.topnavitems=i.children();u.attr("role","navigation");i.addClass(t.menuClass);f.each(function(i,u){var e,f;u=n(u);u.addClass(t.topNavItemClass);e=u.find(":tabbable:first");f=u.children(":not(:tabbable):last");c.call(r,e);f.length&&(c.call(r,f),e.attr({"aria-haspopup":!0,"aria-owns":f.attr("id"),"aria-controls":f.attr("id"),"aria-expanded":!1}),f.attr({role:"group","aria-expanded":!1,"aria-hidden":!0}).addClass(t.panelClass).not("[aria-labelledby]").attr("aria-labelledby",e.attr("id")))});this.panels=i.find("."+t.panelClass);i.on("focusin.accessible-megamenu",":tabbable, :focusable, ."+t.panelClass,n.proxy(w,this)).on("focusout.accessible-megamenu",":tabbable, :focusable, ."+t.panelClass,n.proxy(b,this)).on("keydown.accessible-megamenu",n.proxy(a,this)).on("mouseover.accessible-megamenu",n.proxy(d,this)).on("mouseout.accessible-megamenu",n.proxy(g,this)).on("mousedown.accessible-megamenu",n.proxy(k,this));if(y)i.on("touchstart.accessible-megamenu",n.proxy(s,this));i.find("hr").attr("role","separator")},getDefaults:function(){return this._defaults},getOption:function(n){return this.settings[n]},getAllOptions:function(){return this.settings},setOption:function(n,t,i){this.settings[n]=t;i&&this.init()}}}();n.fn[u]=function(t){return this.each(function(){n.data(this,"plugin_"+u)||n.data(this,"plugin_"+u,new f(this,t))})};n.extend(n.expr[":"],{data:n.expr.createPseudo?n.expr.createPseudo(function(t){return function(i){return!!n.data(i,t)}}):function(t,i,r){return!!n.data(t,r[3])},focusable:function(t){return s(t,!isNaN(n.attr(t,"tabindex")))},tabbable:function(t){var i=n.attr(t,"tabindex"),r=isNaN(i);return(r||i>=0)&&s(t,!r)}})})(jQuery,window,document);